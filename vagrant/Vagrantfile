# -*- mode: ruby -*-
# vi: set ft=ruby :
Vagrant.require_version ">= 1.9.7"

Vagrant.configure(2) do |config|
  $setup_scion = <<-SCRIPT
    echo "Downloading install script..."
    wget https://gist.githubusercontent.com/xabarass/7aa560a2ba9010d8dbb6f08029509ae5/raw/41adcb49dff860fa704fb03aa52e0f0cd1b88bca/scion_install_script.sh
    chmod +x scion_install_script.sh
    echo "Install script downloaded, running it"

    ./scion_install_script.sh -g /vagrant/gen/ -v /vagrant/client.conf -s /vagrant/scion.service -z /vagrant/scion-viz.service
  SCRIPT
  config.vm.box = "scion/ubuntu-16.04-64-scion"
  # Port forwarding not necessary for OpenVPN setup...
  config.vm.network "forwarded_port", guest: 50000, host: 50000, protocol: "udp"
  config.vm.network "forwarded_port", guest: 8000, host: 8000, protocol: "tcp"
  config.vm.provider "virtualbox" do |vb|
    vb.memory = "2048"
    vb.name = "SCIONLabVM"
  end
  config.vm.provision "shell", privileged: false, inline: $setup_scion
end
